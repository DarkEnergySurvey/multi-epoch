#!/usr/bin/env perl
########################################################################
#  $Id: desstat 568 2007-12-17 13:53:25Z dadams $
#
#  $Rev:: 568                              $:  # Revision of last commit.
#  $LastChangedBy:: dadams                 $:  # Author of last commit. 
#  $LastChangedDate:: 2007-12-17 07:53:25 #$:  # Date of last commit.
#
#  Authors: 
#         Michelle Gower (mgower@ncsa.uiuc.edu)
#         Darren Adams (dadams@ncsa.uiuc.edu)
#
#  Developed at: 
#  The National Center for Supercomputing Applications (NCSA)
#  with useful conversations with Jordi Cohen and Jim Phillips from the
#  Theoretical and Computation Biophysics Group at the University
#  of Illinois at Urbana-Champaign.
#
#  Copyright (C) 2007 Board of Trustees of the University of Illinois. 
#  All rights reserved.
#
#  DESCRIPTION:
#
#######################################################################


use Getopt::Long;
use FindBin;
use lib "$FindBin::Bin/../lib";
use DES::utils::misc;


my ($User, $Version);
my ($Out, $Stat);

&Getopt::Long::Configure( 'noignorecase', 'no_autoabbrev');
Getopt::Long::GetOptions(
   'user|u=s' => \$User,
   'version|v' => \$Version
);

my $DESHome = getHome() or die "Error: Can't determine DESHome";

if (defined($Version)) {
  printVersion();
  exit 0;
}

if (defined($User)) {
   $Out = `condor_rm $User`;
   $Stat = $?>>8;
   if ($Stat != 0) {
      print "$Out\n";
   }
   else {
      print "Analyses for user $User have been deleted.\n";
      print "They may remain in the queue for a little while as remote jobs are aborted.\n";
   }
}
elsif (scalar(@ARGV) > 0) {
   if ($ARGV[0] !~ /\D/) {
     $Out = `condor_rm $ARGV[0]`;
     $Stat = $?>>8;
     if ($Stat != 0) {
        print "$Out\n";
     }
     else {
        print "The analysis with master jobid $ARGV[0] has been deleted.\n";
        print "It may remain in the queue for a little while as a remote job is aborted.\n";
     }
   }
   else {
      print STDERR "Error: Invalid id.  Run desstat to see list of analyses.\n";
   }
}
else {
   print STDERR "Usage: desrm (-v | -u user | desid)\n";
}
