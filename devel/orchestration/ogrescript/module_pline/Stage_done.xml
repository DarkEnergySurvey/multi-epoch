   <target name="Stage_done" description="done message">
     <esequence>

        <edeclare name="content_begin"  string="test begin"/>
        <edeclare name="content_end"    string="test end"/>
        <econdblock type="else-if">
          <econdtask>
            <eeval>
             <statement>
                <ecompare string="${platform}">
                   <predicate string="TG" comparator="EQUALS"/>
                </ecompare>
             </statement>
            </eeval>
              <esequence>
                <eassign name="content_begin"  string="Begin Stage_done for ccd ${ccd.num} data on $G{host} for nite ${nite}"/>
                <eassign name="content_end"    string="End Stage_done for ccd ${ccd.num} data on $G{host} for nite ${nite}"/>
              </esequence>
          </econdtask>
              <esequence>
                <eassign name="content_begin"  string="Begin Stage_done for ccd ${ccd.num} for nite ${nite}"/>
                <eassign name="content_end"    string="End Stage_done for ccd ${ccd.num} for nite ${nite}"/>
              </esequence>
        </econdblock>

            <publish>
              <event ensembleid="${ensemble.id}" workflowid="${jid}"
                   nodeid="$R{content_begin}" currentState="1">
                   <property name="message" value="$R{content_begin}"/>
              </event>
            </publish>

        <!-- Remove the data/nite/raw link -->
        <econdblock type="else-if">
          <econdtask>
            <eeval>
             <statement>
                <ecompare string="${platform}">
                   <predicate string="TG" comparator="EQUALS"/>
                </ecompare>
             </statement>
            </eeval>
              <esequence>
                  <rtexec inheritedEnv="false" execDir="." args="/bin/rm ${nite.dir}/raw" quiet="true">
                     <outMonitor file="${local.out}/${done.log}" append="true"/>
                     <errMonitor file="${local.out}/${done.log}" append="true"/>
                  </rtexec>
              </esequence>
          </econdtask>
              <esequence>

                <econdblock type="else-if">
                  <econdtask>
                   <eeval>
                     <statement>
                         <ecompare string="${ccd.num}">
                           <predicate string="01" comparator="EQUALS"/>
                         </ecompare>
                     </statement>
                   </eeval>
                      <esequence>
                         <rtexec inheritedEnv="false" execDir="." args="/bin/rm ${nite.dir}/raw" quiet="true">
                           <outMonitor file="${local.out}/${done.log}" append="true"/>
                           <errMonitor file="${local.out}/${done.log}" append="true"/>
                         </rtexec>
                      </esequence>
                  </econdtask>
                </econdblock>

              </esequence>
        </econdblock>

        <write path="${local.out}/${done.log}" text="true"
                         errorProperty="failed" rethrow="false" append="true">
                         <segment string=" -- Reduction/process for CCD ${ccd.num} at ${nite} done" lineBreaks="1"/>
        </write>

         <publish>
            <event ensembleid="${ensemble.id}" workflowid="${jid}"
                   nodeid="$R{content_end}" currentState="1">
                  <property name="message" value="$R{content_end}"/>
            </event>
         </publish>

     </esequence>
   </target>
